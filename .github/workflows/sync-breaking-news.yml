name: Sync Breaking News from RSS

on:
  schedule:
    - cron: '*/15 * * * *'   # alle 15 Minuten
  workflow_dispatch:         # manuell auslösbar

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fetch RSS & convert to JSON
        uses: actions/setup-node@v4
        with: { node-version: 20 }

      - run: npm install rss-parser
      - run: node -e '
          const Parser = require("rss-parser");
          const parser = new Parser();
          parser.parseURL("https://feeds.a.dj.com/rss/RSSMarketsMain.xml")
            .then(feed => {
              const items = feed.items.slice(0, 8).map(item => ({
                time: new Date(item.pubDate).toLocaleTimeString("de-DE", {hour:"2-digit", minute:"2-digit"}),
                headline: item.title,
                source: "Wall Street Journal Markets",
                category: "Finance"
              }));
              const json = { lastUpdated: new Date().toISOString(), items };
              require("fs").writeFileSync("data/breaking-news.json", JSON.stringify(json, null, 2));
            });
        '

      - name: Commit & Push
        run: |
          git config user.name "World Monitor Bot"
          git config user.email "bot@rosary-mom.github.io"
          git add data/breaking-news.json
          git commit -m "Auto-sync: RSS → breaking-news.json" || echo "No changes"
          git push
